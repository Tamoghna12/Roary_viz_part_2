version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: roary-visualizer:latest
    container_name: roary-visualizer
    ports:
      - "${STREAMLIT_SERVER_PORT:-8501}:8501"
    volumes:
      - ./logs:/app/logs
      - ./tmp:/app/tmp
      - ./data:/app/data
    environment:
      - STREAMLIT_SERVER_PORT=${STREAMLIT_SERVER_PORT:-8501}
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - ENABLE_CACHE=${ENABLE_CACHE:-true}
      - CACHE_TTL_SECONDS=${CACHE_TTL_SECONDS:-300}
      - MAX_MEMORY_MB=${MAX_MEMORY_MB:-1024}
      - MAX_WORKERS=${MAX_WORKERS:-4}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-prod}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M